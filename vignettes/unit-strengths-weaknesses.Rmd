---
title: "Unit Strengths, Weaknesses, and Basic Stats"
output:  
  bookdown::html_document2:
    toc: yes
    toc_depth: 2
    number_sections: yes
pkgdown:
  as_is: true
vignette: >
  %\VignetteIndexEntry{Unit Strengths, Weaknesses, and Basic Stats}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Introduction

Buying [Battle Realms Zen Edition from Steam](https://store.steampowered.com/app/1025600/Battle_Realms_Zen_Edition/) is one of the best buys for a game I have ever made. I still remember the few times I spent with the game in computer shops when I was in high school. I only played a few games, and I struggled to play, much more win, against the AI. I wished I could have played Battle Realms more. With the release of the game is steam, I never thought I would be able to have another chance to at least beat the AIs in the game. 

I am not that big of a fan of real time strategy games because I am not very good at micro-management.

```{r set-options-attach-packages, include = FALSE, warning=FALSE, message=FALSE}

knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  comment = "#>"
)

library(battleRealms)
library(data.table)
library(cdata)
library(ggplot2)
library(magrittr)
library(forcats)

```

# Data Preparation

## Select Variables

```{r select-data-and-columns}

units <- br_units[
  ,
  .(
    UnitID = Type,
    Name,
    UnitClass,
    RiceTrainCost,
    WaterTrainCost,
    YinYangTrainCost,
    MaxHealth,
    HealthRecoveryRate,
    MaxHealthRecovery,
    MaxFatigue,
    FatigueRecovery,
    MeleeWeapon,
    MissileWeapon,
    MissileWeaponLaunchHeight,
    PrefersMelee,
    AMBlunt, 
    AMCutting, 
    AMExplosive,
    AMFire,
    AMMagical,
    AMPiercing,
    MaxUnitsAttacking,
    DeathYinYangAwarded,
    StaminaWhenRunning,
    Bracing,
    ImmuneToCharge,
    InnateAbility,
    BattleGear1,
    BattleGear2,
    BattleGear3
  )
]

weapons <- br_weapons[
  ,
  .(
    Type,
    BaseDamage,
    MinRange,
    MaxRange,
    MaxMountedRange,
    WatchtowerMinRange,
    WatchtowerMaxRange,
    Class,
    DamageClass,
    OpportunityFire,
    AreaOfEffect,
    Poison,
    PoisonTime,
    IsFireWeapon,
    FirePointDamage,
    YinPerHit,
    YangPerHit
  )
]

cols_train_times <- 
  paste0(c("UnitTrainingTime", "UnitIn", "UnitOut"), rep(1:6, each = 3))

train_time <- br_buildings[
  ,
  ..cols_train_times
]

train_time_ct <- data.frame(
  UnitIndex = as.character(1:6),
  UnitIDIn = grep("UnitIn", cols_train_times, value = TRUE),
  UnitIDOut = grep("UnitOut", cols_train_times, value = TRUE),
  TrainTime = grep("UnitTrainingTime", cols_train_times, value = TRUE)
)

train_time <- rowrecs_to_blocks(
  train_time,
  controlTable = train_time_ct
)

setDT(train_time)

train_time <- train_time[, UnitIndex := NULL]

train_chain1 <- train_time[
  ,
  .(
    UnitID = UnitIDOut,
    UnitChain1 = UnitIDIn,
    TrainTime1 = TrainTime
  )
]

train_chain2 <- train_time[
  ,
  .(
    UnitChain1 = UnitIDOut,
    UnitChain2 = UnitIDIn,
    TrainTime2 = TrainTime
  )
]

train_chain3 <- train_time[
  ,
  .(
    UnitChain2= UnitIDOut,
    UnitChain3 = UnitIDIn,
    TrainTime3 = TrainTime
  )
]

train_chain12 <- train_chain1[
  train_chain2,
  on = "UnitChain1", 
  nomatch = 0,
  allow.cartesian = TRUE
]

train_chain123 <- train_chain12[
  train_chain3,
  on = "UnitChain2", 
  nomatch = 0,
  allow.cartesian = TRUE
]

```

## Transform Data

```{r convert-weapons-to-blocks}

units <- pivot_to_blocks(
  units,
  nameForNewKeyColumn = "WeaponType",
  nameForNewValueColumn = "WeaponID",
  columnsToTakeFrom = c("MeleeWeapon", "MissileWeapon")
)

setDT(units)

```

## Combine Unit and Weapons Data

```{r merge-units-weapon,eval=FALSE}

unit_stats <- units[
  weapons,
  on = c("WeaponID" = "Type"),
  nomatch = 0,
  allow.cartesian = TRUE
][
  train_time,
  on = "UnitID",
  nomatch = 0,
  allow.cartesian = TRUE
]

```

# Visualize Data

## Melee Damage

```{r stongest-melee, eval=FALSE}

units_weapons[PrefersMelee == 1][order(BaseDamage, decreasing = TRUE)][1:10] %>%
  ggplot(aes(fct_reorder(Name, -BaseDamage), BaseDamage)) + 
  geom_col()

```

## Missile Damage

```{r stongest-missile, eval=FALSE}

units_weapons[PrefersMelee == 0][order(BaseDamage, decreasing = TRUE)][1:10] %>%
  ggplot(aes(fct_reorder(Name, -BaseDamage), BaseDamage)) + 
  geom_col()

```
